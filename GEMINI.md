# GEMINI.md

Gemini CLI のための開発ルール。

## MCP

- serena

``` text
@serena activate current directory
@serena onboarding
@serena switch_mode ["planning", "one-shot"]
@serena switch_mode ["editing", "interactive"]
@serena think_about_whether_you_are_done
```


## == プロジェクトの目標

このライブラリは、`click` アプリケーションで頻繁に使用される共通オプション（バージョン表示、デバッグフラグ、ヘルプ表示など）を簡単に適用するためのメタデコレータ `click_common_opts` を提供します。これにより、CLI アプリケーションのコードをより簡潔に、かつ一貫性のあるものにすることができます。


### === 参考情報


## == プロジェクト全体のルール

- ルールの定期的な自己チェック:
  * タスクの節目や、特に重要な操作を行う前には、GEMINI.md の主要なルール（特に
     ToDo.md/Tasks.md の運用、確認プロセスの重要性）を意識的に再確認します。

- チャットはすべて日本語で行うこと。

- 実験する前には、十分にリサーチを行うこと。
  - 不明点は、ユーザーにアドバイスを求める。

- **`git commit` はユーザーのみが行う**
  - コミットが必要と考えられるタイミングで、ユーザーにコミットを促すこと。
    - 簡潔で一行のコミットメッセージを英語で提案すること。

- **プロジェクトの構成と管理**
  - `uv` と `pyproject.toml` を通じて行うこと。
  - 常に最新の `uv` 仕様に従うこと。

- **コマンドの実行**
  - 常に `uv run ...` を使用すること。
  - `venv`の`activate`は、明示的に行わないこと。

- **ライブラリのインストール/追加**:
  - `uv add ...` で行うこと。
  - `pip install ...`は使わない。

- **リンティング** は以下で実行すること:
  - `uv run ruff check src samples tests`
  - `uv run mypy src samples tests`
  - `uv run pyright src samples tests`
  - `uv run flake8 src samples tests`
  - ソースコードを修正した場合は、再度、リンティングとテストを実行する。

- **テストプログラム**
  - `tests` ディレクトリの下に、連番で作成すること。
  - **テストの実行**: `uv run python -m pytest -v tests/...`
  - ソースコードを修正した場合は、再度、リンティングとテストを実行する。

- **確実なファイル更新**
  - 新しいファイルを作成し、古いファイルを置き換えるのが一番確実。

### === serena MCPサーバーの利用

- 以下のコマンドで、serana MCPサーバーを初期化する。
  - `serena.activate_project`
  - `serena.onboarding`
 
### === 学習とデバッグの原則

過去の失敗を繰り返さず、効率的な問題解決を確実にするために:

- **公式ドキュメントを優先する
  - ** コア機能、設定、認証については、常に一次情報源を参照すること。
  - 二次情報源からの思い込みを避けること。

- **すべての仮定を検証する
  - ** 命名、暗黙の振る舞い、デフォルト値を疑うこと。
  - 未確認のパターンを避けること。

- **体系的な問題の切り分け:**
  -  各コンポーネント（環境変数、ツール実行、サブプロセスなど）をテストして、根本原因を見つけること。

- **詳細なロギングを活用する:**
  -  内部の洞察と障害の特定のために、デバッグオプションを活用する。

- **ユーザーフィードバックを尊重すること**
  -  継続的な学習と問題診断のために、詳細なレポートを取り入れること。


## == コーディングルール

- ソースコード内のコメントは、通常は日本語で行うこと。
- 各行を78文字以内に収めること。
- デバッグログには `my_logger.py` の `get_logger()` を使用すること。
- `my_logger.py` は変更しないこと。


## == タスクの計画と実行: `ToDo.md` と `Tasks.md`

- `ToDo.md` は **ユーザーのみ** が作成・編集・管理する。
- `Tasks.md` はAIが作成し、管理する。
- `Tasks.md`は、日本語にすること。

- まず、プロジェクトのルートに `ToDo.md` と `Tasks.md` が存在するかどうかを確認する。
  - どちらも存在しない場合は、何もしないで、ユーザーにどうするか尋ねること。

- いずれかのファイルが存在する場合は、以下のルールに従うこと。

- 作業を開始する前には、常に `Tasks.md` を作成
  - 実行を開始する前に、必ずユーザーに確認を求めること。
  - ユーザーが明確に **"進めて"** と言うまで、処理を進めないこと。
  - 開始後は、`Tasks.md`の項目については、連続実行してもよい。

### === `Tasks.md` が存在する場合

- 未チェックのタスク項目を上から順番に実行する。
- ソースコードを修正した後は、常に以下を実行すること:
  - リンティングの実行
  - テストプログラムの作成、更新、実行

- `Tasks.md`のタスク項目が一つ完了するごとに、**`Tasks.md` ファイル内の該当する `[ ]` を `[x]` に変更してマークする**。
  - マークしたら、マークされてない先頭の項目を実行する。

- タスク項目にないことを実行する必要が生じた場合、ユーザーにどうすべきか確認する。
  - 自己判断で進めないこと。

- `Tasks.md` のすべてのタスクが完了した場合
  1. ユーザーに完了を報告
  2. ユーザーが、`ToDo.md` を更新するよう促す。
  2. `uv run archive_file.py Tasks.md` を実行する。
     このスクリプトは:
     - `Tasks.md` を `yyyymmdd-HHMM-Tasks-done.md` にリネームする
       （`yyyymmdd` = 日付, `HHMM` = 時刻）。
     - ファイルを `archives` ディレクトリに移動する。

### === `Tasks.md` が存在しない場合

- `ToDo.md` をレビューする:
  - 先頭の未チェックの **チェックリスト項目** を特定し、その項目について、ステップ・バイ・ステップの詳細なタスクに分割し、`Tasks.md` にチェックリストを作成する。
  - 原則として、`ToDo.md` の1つの **チェックリスト項目** = `Tasks.md`ファイルが1つ。
  - `Tasks.md` を作成したら、実行する前に必ずユーザーに確認を求めること。
  - ユーザーが **"進めて"** と言った場合は、タスクを順に実行する。
